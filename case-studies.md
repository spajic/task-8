# Case #1 Оптимизация лендинга

Как таковой особой проблемы не было, решил на практике попробовать web-page-test.

## Исходное состояние сайта:

<img width="976" alt="Screenshot 2019-05-10 at 02 42 43" src="https://user-images.githubusercontent.com/987021/57494615-d3958180-72d2-11e9-9199-dbfdfabafb3c.png">

* Время загрузки 7.212s
* Начало рендеринга 3.500s
* Speed Index 4.830s

## Обнаруженные проблемы и возможности

* Не используется HTTP/2
* Не используется сжатие при передаче ассетов
* Некоторые изображения сжаты неоптимально

## Оптимизации и улучшения

* Обновлена система и софт и включен HTTP/2
* Включено gzip сжатие для всех ассетов
* Часть изображений пережата более оптимально
* Для больших круглых изображений с прозрачным фоном помимо дефолтного PNG формата (изображения 100-200 КБ) были добавлены современные форматы WebP и JPEG2000, что значительно уменьшило размер до 10-30 КБ. Для поддержки автоопределения формата изображения подходящего пользователю использовать HTML5 тег `<picture>`
* Для ускорения отображения сайта изображения из хедера доставляются в браузер с использованием server-push

## Результат

* Время загрузки 2.792s
* Начало рендеринга 1.900s
* Speed Index 2.508s

Ускорение времени загрузки сайта составило 2.5 раза

<img width="958" alt="Screenshot 2019-05-10 at 02 58 34" src="https://user-images.githubusercontent.com/987021/57494616-d3958180-72d2-11e9-92cd-fbd7aa3b3ee3.png">

# Case #2 Обновление версии Ruby

## Исходное состояние

Web-сервер и TCP-сервер (на event machine) работали на Ruby 2.3, время поддержки уже закончилось (2019-03-31), часть новых гемов уже не работает.

<img width="1241" alt="web-2 3-time" src="https://user-images.githubusercontent.com/987021/57494630-f031b980-72d2-11e9-9337-333138749cd3.png">
<img width="1223" alt="web-2 3-hist" src="https://user-images.githubusercontent.com/987021/57494638-f3c54080-72d2-11e9-9e55-1f7e3e4299bf.png">
<img width="1233" alt="ruby-2 3" src="https://user-images.githubusercontent.com/987021/57494639-f6279a80-72d2-11e9-936f-a308c981e22a.png">

## Результат

В качестве метрики используем среднее время ответа сервера из NewRelic:

| Приложение | 2.3 | 2.6 | Прирост |
| --- | --- | --- | --- |
| Web-server |77.1|70.7|9%|
| TCP-server |2.41|1.95|23.5%|

<img width="1232" alt="web-2 6-time" src="https://user-images.githubusercontent.com/987021/57494653-03dd2000-72d3-11e9-9bac-dfd4ca92b25c.png">
<img width="1224" alt="web-2 6-hist" src="https://user-images.githubusercontent.com/987021/57494657-063f7a00-72d3-11e9-9cf6-2a44b72ebd1c.png">
<img width="1240" alt="ruby-2 6" src="https://user-images.githubusercontent.com/987021/57494663-08a1d400-72d3-11e9-97ef-70936adc8ea2.png">
